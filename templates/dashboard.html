<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Task Dashboard</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='css/dashboard.css') }}">
</head>
<body>
  <div class="dashboard-wrapper">

    <!-- Sidebar -->
    <aside class="sidebar">
      <div class="sidebar-content">
        <div class="sidebar-top">
          <h3 class="sidebar-title">Categories</h3>
          <ul class="category-list">
            <li>
                <!--            AAA: Êää‰∏äÈù¢ÂèñÊ∂àÊ≥®Èáä‰∏ãÈù¢Ê≥®ÈáäËµ∑Êù•-->
<!--              <a href="{{ url_for('dashboard', category='all', user_id=request.args.get('user_id')) }}" class="category-link">All Tasks</a>-->
              <a href="{{ url_for('dashboard', category='all') }}" class="category-link">All Tasks</a>
            </li>
            {% for category in categories %}
            <li>
                <!--            AAA: Êää‰∏äÈù¢ÂèñÊ∂àÊ≥®Èáä‰∏ãÈù¢Ê≥®ÈáäËµ∑Êù•-->
<!--              <a href="{{ url_for('dashboard', category=category.id, user_id=request.args.get('user_id')) }}" class="category-link">-->
<!--                {{ category.name }}-->
<!--              </a>-->
              <a href="{{ url_for('dashboard', category=category.id) }}" class="category-link">{{ category.name }}</a>
            </li>
            {% endfor %}
          </ul>

                <!--            AAA: Êää‰∏äÈù¢ÂèñÊ∂àÊ≥®Èáä‰∏ãÈù¢Ê≥®ÈáäËµ∑Êù•-->
<!--          <form action="/api/categories" method="POST" class="category-form">-->
          <form action="{{ url_for('api_add_category') }}" method="POST" class="category-form">
            <input
              type="text"
              name="name"
              placeholder="New category"
              class="category-input"
              required
            />
              <!--            AAA: Êää‰∏ãÈù¢ÂèñÊ∂àÊ≥®Èáä-->
<!--            <input type="hidden" name="user_id" value="{{ request.args.get('user_id') or '' }}">-->
            <button type="submit" class="btn-add-category">Add</button>
          </form>
        </div>

        <div class="sidebar-bottom">
          <p class="user-info">Logged in as <strong>{{ user.username }}</strong></p>
          <form action="/logout" method="POST">
            <button type="submit" class="btn-logout">Log out</button>
          </form>
        </div>
      </div>
    </aside>

    <!-- Main Task Section -->
    <section class="main-content">
      <div class="content-header">
        <h2 class="page-title">Task Dashboard</h2>
        <div class="header-actions">
          {% if request.args.get('sort') == 'priority' %}
            <button class="btn-sort-priority active" onclick="clearSort()">üìÖ Sorted by Priority</button>
          {% else %}
            <button class="btn-sort-priority" onclick="sortByPriority()">üìÖ Sort by Priority</button>
          {% endif %}
          <a href="/add-task">
            <button class="btn-add-task">Add Task</button>
          </a>
        </div>
      </div>

      <!-- Notifications Section -->
      {% if upcoming_deadlines %}
      <div class="notifications-section">
        <h3 class="notifications-title">üìÖ Upcoming Deadlines</h3>
        <div class="notifications-list">
          {% for deadline in upcoming_deadlines %}
          <div class="notification-card priority-{{ deadline.priority|lower }}">
            <div class="notification-content">
              <span class="notification-task">{{ deadline.title }}</span>
              <span class="notification-countdown">
                {% if deadline.days_left == 0 %}
                  <strong>Due Today!</strong>
                {% elif deadline.days_left == 1 %}
                  <strong>1 day left</strong>
                {% else %}
                  <strong>{{ deadline.days_left }} days left</strong>
                {% endif %}
              </span>
            </div>
          </div>
          {% endfor %}
        </div>
      </div>
      {% endif %}

      <table class="task-table">
        <thead>
          <tr>
            <th>Title</th>
            <th>Category</th>
            <th>Status</th>
            <th>Priority</th>
            <th>Due Date</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          {% for task in tasks %}
          <tr>
            <td>{{ task.title }}</td>
            <td>{{ task.category }}</td>
            <td>{{ task.status }}</td>
            <td>{{ task.priority }}</td>
            <td>{{ task.due_date or 'No due date' }}</td>
            <td class="action-cell">
              <a href="/edit-task/{{ task.id }}" class="btn-edit">‚úèÔ∏è</a>
              <form method="POST" action="/api/tasks/{{ task.id }}/delete" style="display: inline;">
                <button 
                  type="submit" 
                  class="btn-delete"
                  onclick="return confirm('Delete this task?')"
                >üóëÔ∏è</button>
              </form>
            </td>
          </tr>
          {% else %}
          <tr>
            <td colspan="6" class="empty-state">No tasks yet. Click "Add Task" to get started!</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </section>
  </div>

  <script>
    function sortByPriority() {
      // Get current URL parameters
      const urlParams = new URLSearchParams(window.location.search);
      
      // Add sort parameter to URL (preserves existing category parameter)
      urlParams.set('sort', 'priority');
      
      // Redirect to dashboard with sort parameter
      window.location.href = `/dashboard?${urlParams.toString()}`;
    }
    
    function clearSort() {
      // Get current URL parameters
      const urlParams = new URLSearchParams(window.location.search);
      
      // Remove sort parameter
      urlParams.delete('sort');
      
      // Redirect to dashboard without sort parameter
      window.location.href = `/dashboard?${urlParams.toString()}`;
    }
  </script>
</body>
</html>

